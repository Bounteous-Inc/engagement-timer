!function(a,b){"use strict";function c(b){if(!b.each&&!b.every)throw new Error("Requires opts.each or opts.every.");if((b.idleAfter||b.engagementEvents)&&!(b.idleAfter&&b.engagementEvents&&b.engagementEvents.length))throw new Error("Configure opts.idleAfter & opts.engagementEvents for idling.");if(!(this instanceof c))return new c(b);var d,e=b.context||a;if("string"==typeof e&&(e=a.querySelector(b.context)),!e)throw new Error("Unable to find context "+b.context);this._context=e,this._startTime=b.startTime||k,this._trackedTime=Math.ceil((+new Date-this._startTime)/1e3),this._max=b.max||1/0,this._min=b.min||0,this._every=b.every||[],this._each=b.each||[],this._gcd=g(this._every.concat(this._each)),this._each._originals=this._each.slice(0),this._every._originals=this._every.slice(0),this._events={},this._cache={},this._lastTick=this._startTime,setTimeout(this.start.bind(this),0),b.idleAfter&&b.engagementEvents&&(this._idleAfter=1e3*b.idleAfter+100,this._idleTimer=this._resetIdleTimeout(),d=j(this._preventIdle.bind(this),this._idleTimeout/2),b.engagementEvents.forEach(function(a){this._context.addEventListener(a,d)}.bind(this))),b.idleOnVisibilityChange&&i(function(a){a?this.pause():this.start()}.bind(this))}function d(a,b,c){var d;for(d=a.length-1;d>=0;d--)b(a[d])&&c(a[d],d,a)}function e(a,b){return a>b?1:b>a?-1:0}function f(a,b){if(a=Math.abs(a),(b=Math.abs(b))>a)return f(b,a);for(;;){if(0===b)return a;if(0===(a%=b))return b;b%=a}}function g(a){if(1===a.length)return a[0];var b=a.pop();return a.reduce(function(a,b){return f(a,b)},b)}function h(a){return void 0!==a}function i(c){var d,e;h(a.hidden)?(e="hidden",d="visibilitychange"):h(a.mozHidden)?(e="mozHidden",d="mozvisibilitychange"):h(a.msHidden)?(e="msHidden",d="msvisibilitychange"):h(a.webkitHidden)&&(e="webkitHidden",d="webkitvisibilitychange"),d?a.addEventListener(d,function(){c(a[e])}):(b.addEventListener("blur",function(){c(!0)}),b.addEventListener("focus",function(){c(!1)}))}function j(a,b){var c,d,e,f=null,g=0,h=function(){g=new Date,f=null,e=a.apply(c,d)};return function(){var i=new Date;g||(g=i);var j=b-(i-g);return c=this,d=arguments,j<=0?(clearTimeout(f),f=null,g=i,e=a.apply(c,d)):f||(f=setTimeout(h,j)),e}}var k=+new Date;b.EngagementTimer=b.EngagementTimer||c;var l=function(){function a(a,e,f){if(e<1e3)throw new Error("Interval is too frequent.");var g=this.tickId=d++;f?c[g]=setTimeout(function(){a(),b(a,e,g)}.bind(this),f):b(a,e,this.tickId)}function b(a,d,e){c[e]=setTimeout(function(){a(),b(a,d,e)},d)}var c={},d=1;return a.prototype.clear=function(){clearTimeout(c[this.tickId])},a}();c.prototype._timer=function(a){return new l(function(){var a=+new Date;if(this._trackedTime+=Math.floor((a-this._lastTick)/1e3),this._lastTick=a,!(this._trackedTime<this._min))return this._trackedTime>this._max?this.destroy():void this._checkMarks()}.bind(this),1e3*this._gcd,a)},c.prototype.on=function(a,b){(this._events[a]=this._events[a]||[]).push(b)},c.prototype.reset=function(){this._each=this._each._originals.slice(0),this._every=this._every._originals.slice(0),this._trackedTime=0,this._startTime=+new Date,this._cache={},this.emit("reset",{data:{timestamp:+new Date}})},c.prototype.start=function(){console.log(this._offset),this._tick||(this._tick=this._timer(this._offset)),this.emit("start",{data:{timestamp:+new Date}})},c.prototype.pause=function(){var a=+new Date;this._offset=Math.floor((a-this._lastTick)/1e3),this._tick&&this._tick.clear(),this._tick=null,this._running=0,this.emit("pause",{data:{timestamp:+new Date}})},c.prototype.emit=function(a,b){this._events[a]&&this._events[a].forEach(function(a){setTimeout(function(){a(b)},0)})},c.prototype.destroy=function(){this._tick&&this._tick.clear()},c.prototype._checkMarks=function(){function a(a){return f>=a}function b(a,b,c){var d=this._every._originals[b];g.push(a),c[b]=(a/d+1)*d}function c(a,b){g=g.concat(this._each.slice(b,1))}var f=this._trackedTime,g=[];d(this._each,a,c.bind(this)),d(this._every,a,b.bind(this)),g.sort(e).forEach(this._checkMark.bind(this))},c.prototype._checkMark=function(a){this._cache[a]||(this._cache[a]=!0,this.emit("interval",{data:{time:a}}))},c.prototype._preventIdle=function(){this._tick||this.start(),clearTimeout(this._idleTimer),this._idleTimer=this._resetIdleTimeout()},c.prototype._resetIdleTimeout=function(){return setTimeout(function(){this.pause()}.bind(this),this._idleAfter)}}(document,window);
/*
 * v2.0.0
 * Created by the Google Analytics consultants at http://www.lunametrics.com/
 * Written by @notdanwilkerson
 * Documentation: https://www.lunametrics.com/labs/recipes/engagement-timer/
 * Licensed under the MIT License
 */